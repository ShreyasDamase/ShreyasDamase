name: Update LeetCode Stats

on:
  schedule:
    - cron: '0 0 * * *' # Runs daily at midnight (UTC)
  workflow_dispatch: # Allows manual triggering

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v3

      - name: ðŸ“¥ Install jq (JSON Parser)
        run: sudo apt-get install jq

      - name: ðŸ”„ Fetch LeetCode Stats
        run: |
          USERNAME="shreyas_damase"
          API_URL="https://leetcode-api-faisalshohag.vercel.app/${USERNAME}"
          RESPONSE=$(curl -s $API_URL)

          TOTAL_SOLVED=$(echo $RESPONSE | jq -r '.totalSolved')
          EASY_SOLVED=$(echo $RESPONSE | jq -r '.easySolved')
          MEDIUM_SOLVED=$(echo $RESPONSE | jq -r '.mediumSolved')
          HARD_SOLVED=$(echo $RESPONSE | jq -r '.hardSolved')
          RANKING=$(echo $RESPONSE | jq -r '.ranking')

          echo "âœ… LeetCode Stats Fetched: Solved=$TOTAL_SOLVED, Easy=$EASY_SOLVED, Medium=$MEDIUM_SOLVED, Hard=$HARD_SOLVED, Rank=$RANKING"

          # ðŸ“Œ Update README.md using `awk`
          awk -v total="$TOTAL_SOLVED" -v easy="$EASY_SOLVED" -v medium="$MEDIUM_SOLVED" -v hard="$HARD_SOLVED" -v rank="$RANKING" '
            /ðŸ† Total Solved/ {print "| ðŸ† Total Solved | ðŸ’¡ Easy | âš¡ Medium | ðŸ”¥ Hard | ðŸ… Rank |"; next}
            /|---|---|---|---|---|/ {print "|---|---|---|---|---|"; next}
            /\[Total\]/ {print "| ![Total](https://img.shields.io/badge/Solved-" total "-blue) | ![Easy](https://img.shields.io/badge/Easy-" easy "-green) | ![Medium](https://img.shields.io/badge/Medium-" medium "-orange) | ![Hard](https://img.shields.io/badge/Hard-" hard "-red) | ![Rank](https://img.shields.io/badge/Rank-" rank "-purple) |"; next}
            {print}
          ' README.md > README_TEMP.md && mv README_TEMP.md README.md

      - name: ðŸ”„ Commit and Push Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions@github.com"
          git add README.md
          git commit -m "Updated LeetCode stats dynamically" || echo "No changes to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
